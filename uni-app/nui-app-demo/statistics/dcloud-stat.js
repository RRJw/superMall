!function(){"use strict";var e={onLaunch:function(){},onHide:function(){},onShow:function(){}};function a(t,e,a){if(t[e]){var i=t[e];t[e]=function(t){i.call(this,t),a.call(this,t,e)}}else t[e]=function(t){a.call(this,t,e)}}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}var _="0.0.2",r=require("crypto");function f(t){var e=Object.keys(t).sort(),a={},i="";for(var n in e)a[e[n]]=t[e[n]],i+=e[n]+"="+t[e[n]]+"&";var s=i.substr(0,i.length-1);return i=i.substr(0,i.length-1)+"&key=qkTHEIegZGcL5iy3",{sign:r.createHash("md5").update(i).digest("hex"),options:s}}function v(t){var e=new Date;return e=e.getTime()/1e3,parseInt(e)}function u(){var t="";switch(process.env.VUE_APP_PLATFORM){case"app-plus":t="n";break;case"h5":t="h5";break;case"mp-weixin":t="wx";break;case"mp-alipay":t="ali";break;case"mp-baidu":t="bd";break;case"mp-toutiao":t="tt";break;case"mp-qq":t="qq"}return t}function c(){var t=(new Date).getTime();return uni.setStorageSync("Set__First__Time",t),uni.removeStorageSync("Set__Last__Time"),t}function l(){var t=(new Date).getTime();return uni.setStorageSync("Set__Last__Time",t),t}function h(t){var e=uni.getStorageSync("Set__First__Time")||0,a=(uni.getStorageSync("Set__Last__Time")||0)-e;return a=(a=parseInt(a/1e3))<1?1:a,"app"===t?{residenceTime:a,overtime:300<a}:"page"!==t?{residenceTime:a}:{residenceTime:a,overtime:1800<a}}function p(t){var e=t.self,a=t._query,i=a&&"{}"!==JSON.stringify(a)?"?"+JSON.stringify(a):"";return t._query="","bd"===u()?e.$mp&&e.$mp.page.is+i:e.$mp&&e.$mp.page.route+i}function g(t){if("string"==typeof t)return{check:255<t.length,msg:" 的长度超过 255 个字符"};if("object"!==o(t))return!1;var e=!1;for(var a in t)if("string"!=typeof t[a]){e=!0;break}return{check:e,msg:" 对象的值只能为 string 类型"}}function d(t){return!!("page"===t.mpType||t.$mp&&"page"===t.$mp.mpType)}function y(t){P.report(t,this)}function m(t){P.load(t,this)}function D(t){P.show(this)}function k(t){P.hide(this)}function S(){P.hide(this)}function q(t){P.error(t)}function R(t){P.interceptShare(!1)}var t,T,w=require("./dcloud-stat-config.js"),b=((t=uni.getStorageSync("uuid"))&&36===t.length||(t=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^(void 0!==r&&r.getRandomValues?r.getRandomValues(new Uint8Array(1))[0]:Math.floor(255*Math.random()))&15>>t/4).toString(16)}),uni.setStorageSync("uuid",t)),t),E=u(),N="n"===u()?plus.runtime.version:"",I=(T="","n"===u()&&(T=plus.runtime.channel),T),L=v(),H=uni.getSystemInfoSync(),O=new(function(){function t(){i(this,t),this.self="",this._retry=0,this._platform="",this._query={},this._navigationBarTitle={config:"",page:"",report:"",lt:""},this._operatingTime=0,this._reportingRequestData={1:[],11:[]},this.__prevent_triggering=!1,this.__licationHide=!1,this.__licationShow=!1,this._lastPageRoute="",this.statData={uuid:b,ut:E,ak:w.app_key,usv:_,v:N,ch:I,cn:"",pn:"",ct:"",t:L,tt:""}}return s(t,[{key:"_applicationShow",value:function(){if(this.__licationHide){if(l(),h("app").overtime){var t={path:this._lastPageRoute,scene:this.statData.sc};this._sendReportRequest(t)}this.__licationShow=!0,this.__licationHide=!1}}},{key:"_applicationHide",value:function(t,e){this.__licationHide=!0,l();var a=h();c(),this._sendHideRequest({urlref:this._lastPageRoute,urlref_ts:a.residenceTime},e)}},{key:"_pageShow",value:function(t){var e=p(this);if(this.__licationShow)return this.__licationShow=!1,c(),void(this._lastPageRoute=e);l();var a=h("page");if(c(),a.overtime){var i={path:this._lastPageRoute,scene:this.statData.sc};this._sendReportRequest(i)}else this._sendPageRequest({url:e,urlref:this._lastPageRoute,urlref_ts:a.residenceTime});this._lastPageRoute=e}},{key:"_pageHide",value:function(t){if(!this.__licationHide){var e=this._navigationBarTitle,a=e.report||e.page||e.config||"";return this._reportingRequestData[e.lt]&&(this._reportingRequestData[e.lt][this._reportingRequestData[e.lt].length-1].tt=a),void(O._navigationBarTitle={config:"",page:"",report:"",lt:""})}}},{key:"_login",value:function(){this._sendEventRequest({key:"__uni__login"},0)}},{key:"_share",value:function(){this._sendEventRequest({key:"__uni__share"},0)}},{key:"_payment",value:function(t){this._sendEventRequest({key:t},0)}},{key:"_sendReportRequest",value:function(t,e){this._navigationBarTitle.lt="1";var a=t.query&&"{}"!==JSON.stringify(t.query)?"?"+JSON.stringify(t.query):"";this.statData.lt="1",this.statData.url=t.path+a,this.statData.t=v(),this.statData.sc=function(t){var e=u(),a="";return t||("wx"===e&&(a=uni.getLaunchOptionsSync().scene),a)}(t.scene),this.statData.fvts=function(t){var e=uni.getStorageSync("First__Visit__Time"),a=0;return e?a=e:(a=v(),uni.setStorageSync("First__Visit__Time",a),uni.removeStorageSync("Last__Visit__Time")),a}(),this.statData.lvts=function(t){var e=uni.getStorageSync("Last__Visit__Time"),a=0;return a=e||"",uni.setStorageSync("Last__Visit__Time",v()),a}(),this.statData.tvc=function(){var t=uni.getStorageSync("Total__Visit__Count"),e=1;return t&&(e=t,e++),uni.setStorageSync("Total__Visit__Count",e),e}(),this.getDeviceInfo()}},{key:"_sendPageRequest",value:function(t){var e=t.url,a=t.urlref,i=t.urlref_ts;this._navigationBarTitle.lt="11";var n={ak:this.statData.ak,uuid:this.statData.uuid,lt:"11",ut:this.statData.ut,url:e,tt:this.statData.tt,urlref:a,urlref_ts:i,ch:this.statData.ch,usv:this.statData.usv,t:v(),p:this.statData.p};this.request(n)}},{key:"_sendHideRequest",value:function(t,e){var a=t.urlref,i=t.urlref_ts,n={ak:this.statData.ak,uuid:this.statData.uuid,lt:"3",ut:this.statData.ut,urlref:a,urlref_ts:i,ch:this.statData.ch,usv:this.statData.usv,t:v(),p:this.statData.p};this.request(n,e)}},{key:"_sendEventRequest",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.key,a=void 0===e?"":e,i=t.value,n=void 0===i?"":i,s=p(this),r={ak:this.statData.ak,uuid:this.statData.uuid,lt:"21",ut:this.statData.ut,url:s,ch:this.statData.ch,e_n:a,e_v:"object"===o(n)?JSON.stringify(n):n.toString(),usv:this.statData.usv,t:v(),p:this.statData.p};this.request(r)}},{key:"getDeviceInfo",value:function(){process.env.NODE_ENV;var t=H.platform;this._platform=t,this.statData.p="android"===H.platform?"a":"i",this.statData.brand=H.brand||"",this.statData.md=H.model,this.statData.sv=H.system.replace(/(Android|iOS)\s/,""),this.statData.mpsdk=H.SDKVersion||"",this.statData.mpv=H.version||"",this.statData.lang=H.language,this.statData.pr=H.pixelRatio,this.statData.ww=H.windowWidth,this.statData.wh=H.windowHeight,this.statData.sw=H.screenWidth,this.statData.sh=H.screenHeight,this.getNetworkInfo()}},{key:"getNetworkInfo",value:function(){var e=this;uni.getNetworkType({success:function(t){e.statData.net=t.networkType,e.getLocation()}})}},{key:"getLocation",value:function(){var e=this;w.getLocation?uni.getLocation({type:"wgs84",geocode:!0,success:function(t){t.address&&(e.statData.cn=t.address.country,e.statData.pn=t.address.province,e.statData.ct=t.address.city),e.statData.lat=t.latitude,e.statData.lng=t.longitude,e.request(e.statData)}}):(this.statData.lat=0,this.statData.lng=0,this.request(this.statData))}},{key:"request",value:function(e,t){var a=this,i=v(),n=this._operatingTime;this._reportingRequestData[e.lt]||(this._reportingRequestData[e.lt]=[]),this._reportingRequestData[e.lt].push(e);var s=this._navigationBarTitle,r=s.report||s.page||s.config||"";if(this._reportingRequestData[s.lt]&&(this._reportingRequestData[s.lt][this._reportingRequestData[s.lt].length-1].tt=r),!(i-n<10)||t){this._operatingTime=v();var o=[],u=[],c=[],l=function(i){a._reportingRequestData[i].forEach(function(t,e){var a=function(t){var e="";for(var a in t)e+=a+"="+t[a]+"&";return e=e.substr(0,e.length-1)}(t);0===i?o.push(a):3===i?c.push(a):u.push(a)})};for(var h in this._reportingRequestData)l(h);o.push.apply(o,u.concat(c));var p={usv:_,t:i,requests:JSON.stringify(o)};p.si=f(p).sign,this._reportingRequestData={},"h5"!==e.ut?uni.request({url:"https://stream.dcloud.net.cn/uni/stat",method:"GET",data:p,success:function(t){"development"===process.env.NODE_ENV&&console.log("stat request success")},fail:function(t){"development"===process.env.NODE_ENV&&console.log("stat request fail",t),++a._retry<3&&setTimeout(function(){a.request(e)},1e3)}}):this.imageRequest(p)}}},{key:"imageRequest",value:function(t){var e=new Image,a=f(function(t){var e={};for(var a in t)e[a]=encodeURIComponent(t[a]);return e}(t)).options;e.src="https://stream.dcloud.net.cn/uni/stat.gif?"+a}}]),t}()),P=new(function(){function t(){i(this,t),this.addInterceptorInit(),this.interceptLogin(),this.interceptShare(!0),this.interceptRequestPayment()}return s(t,[{key:"addInterceptorInit",value:function(){var e=this;uni.addInterceptor("setNavigationBarTitle",{invoke:function(t){e._navigationBarTitle.page=t.title}})}},{key:"interceptLogin",value:function(){uni.addInterceptor("login",{invoke:function(){},complete:function(t){O._login()}})}},{key:"interceptShare",value:function(t){t?uni.addInterceptor("share",{invoke:function(){},success:function(t){O._share()},fail:function(){O._share()}}):O._share()}},{key:"interceptRequestPayment",value:function(){uni.addInterceptor("requestPayment",{invoke:function(){},success:function(t){O._payment("__uni__pay_success")},fail:function(){O._payment("__uni__pay_fail")}})}},{key:"report",value:function(t,e){O.self=e,"development"===process.env.NODE_ENV&&console.log("report init"),O._operatingTime=v(),O.__licationShow=!0,O._sendReportRequest(t,!0)}},{key:"load",value:function(t,e){O._query=t}},{key:"show",value:function(t){O.self=t,d(t)?O._pageShow(t):O._applicationShow(t)}},{key:"hide",value:function(t){O.self=t,d(t)?O._pageHide(t):O._applicationHide(t,!0)}},{key:"error",value:function(t){if("devtools"!==O._platform){var e="";e="h5"===E?t.toString():JSON.stringify(t).substr(0,255).replace(/\\n/g," ").replace(/\s+/g," ").replace(/\\/g,"").replace(/\"/g,"'");var a={ak:O.statData.ak,uuid:O.statData.uuid,lt:"31",ut:O.statData.ut,ch:O.statData.ch,mpsdk:O.statData.mpsdk,mpv:O.statData.mpv,v:O.statData.v,em:e,usv:O.statData.usv,t:v(),p:O.statData.p};O.request(a)}else"development"===process.env.NODE_ENV&&console.info("当前运行环境为开发者工具，不上报数据。")}},{key:"sendEvent",value:function(t,e){var a=g(t),i=g(e);e?a.check?console.error("自定义事件的 key"+a.msg):i.check?console.error("自定义事件的 value"+i.msg):O._sendEventRequest({key:t,value:e},1):console.error("自定义事件 value 不能为空")}},{key:"seedReportEvent",value:function(t){var e=t.title;t.url;O._navigationBarTitle.report=e}}]),t}());module.exports.init=function(t){a(e,"onLaunch",y),a(e,"onLoad",m),a(e,"onShow",D),a(e,"onHide",k),a(e,"onUnload",S),a(e,"onError",q),a(e,"onShareAppMessage",R),t.mixin(e),t.prototype.$stat={sendEvent:P.sendEvent,report:P.seedReportEvent}}}();
